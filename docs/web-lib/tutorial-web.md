---
sidebar_position: 1
---

# Tutorial - Mercuru web library

To use the Mercury web client library, first clone the mercurylayer repository:

```
git clone https://github.com/commerceblock/mercurylayer.git
```

Then switch to the `dev` branch:

```
cd mercurylayer
git checkout dev
```

Install dependencies for web:

```
cd clients/libs/web
npm install
```

Then in the application:

Import the web library: 

```js
import mercuryweblib from 'mercuryweblib';
```

Define the configuration object to set the mercury server and electrum endpoint:

```js
const clientConfig = {
  esploraServer: "https://mutinynet.com",
  statechainEntity: "http://test.mercurylayer.com:8500",
  network: "testnet",
  feeRateTolerance: 5,
  confirmationTarget: 2,
  maxFee: 1
};
```

The test mercury key server URL is: `http://test.mercurylayer.com:8500`

> Note that this is a test server. It is free to use, but there is no guarantee of persistence or security. Use only for testnet or signet coins. 

Initialise a wallet using:

```js
let wallet1 = await mercuryweblib.createWallet(clientConfig, "wallet1");
```

Create a second wallet to receieve a coin:

```js
let wallet2 = await mercuryweblib.createWallet(clientConfig, "wallet2");
```

In order to use the mercury layer key server, an access token is required in order to create a shared key. For the test server, tokens can be generated as follows and added to the wallet:

```js
await mercuryweblib.newToken(clientConfig, wallet1.name);
```

With a valid token recieved by the client, it is then possible to generate a shared key and address (`depositAddress`) to deposit testnet bitcoin (e.g. `1000` sats) into:

```js
const amount = 1000;
let result = await mercuryweblib.getDepositBitcoinAddress(clientConfig, wallet1.name, amount);
const statechainId = result.statechain_id;
const depositAddress = result.deposit_address;
```

Then pay the specified amount to it. For the mutinynet signet network, this payment can be made directly via the faucet: [faucet.mutinynet.com](https://faucet.mutinynet.com/)

Once paid, run:

```js
const coins = await mercuryweblib.listStatecoins(clientConfig, wallet1.name);
```

The `coins` array will contain a list of statecoins and their status (`coin.status`). `coin.status === CoinStatus.IN_MEMPOOL` means the deposit transaction is in the mempool. `coin.status === CoinStatus.CONFIRMED` means the deposit transaction has been confirmed, and the coin can now be transferrred to another user. 

To generate a statecoin receieve address, run:

```js
let toAddress = await mercuryweblib.newTransferAddress(wallet2.name);
```

Which will generate a mercury layer address to recieve a coin to. e.g.:

```js
toAddress.transfer_receive
"tml1qqp7m5tc9auxgwka84tez9vksky2lsp5uftyhhduakt75j8yq46wh3crh26fwzxw2akc43d9m0pvuhmuq57tcdtw7pz96zfsz8ck3d3jjf3q04re26"
```

This address can then be used to send a specified coin (with `statechainId`) coin to a specified statechain address:

```js
await mercuryweblib.transferSend(clientConfig, wallet1.name, statechainId, toAddress.transfer_receive, false, null);
```

The coin receiver (`wallet2`) then completes recieve with:

```js
const transferReceiveResult = await mercuryweblib.transferReceive(clientConfig, wallet2.name);
```

If the receive completes successfully `transferReceiveResult.receivedStatechainIds` will contain `statechainId`. 

To withdraw the coin back to an onchain address (`toAddress`):

```js
await mercuryweblib.withdrawCoin(clientConfig, wallet2.name, statechainId, toAddress, null, null);
```

For the demo test coins, these can be sent back to an address generated by the faucet: [faucet.mutinynet.com](https://faucet.mutinynet.com/)

In case the coin expires and the mercury server is unavailable, the backup transaction can be used for withdrawal as follows (with `feeRate` set to sats/byte):

```js
await mercuryweblib.broadcastBackupTransaction(clientConfig, wallet2.name, statechainId, toAddress, feeRate);
```
